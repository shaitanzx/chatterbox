<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatterbox TTS Server</title>

    <link rel="stylesheet" href="styles.css">
    <script src="vendor/wavesurfer.min.js"></script>
</head>

<body class="body-base">
<div class="min-h-full">
<nav class="nav-base">
	<div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
		<div class="flex h-16 items-center justify-between">
			<div class="flex items-center">
				<div class="flex-shrink-0">
					<a href="/" id="app-title-link" class="title-link">Chatterbox TTS Server</a>
				</div>
			</div>
			<div class="flex items-center space-x-3 sm:space-x-4">
				<a href="/docs" target="_blank" class="nav-link">API Docs</a>
				<button id="theme-toggle-btn" type="button" class="theme-switch-button"
					title="Toggle light/dark mode">
					<span class="sr-only">Toggle theme</span>
					<span class="theme-switch-thumb">
						<svg class="theme-icon-sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
							fill="currentColor">
							<path
								d="M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.166a.75.75 0 00-1.06-1.06l-1.591 1.59a.75.75 0 101.06 1.061l1.591-1.59zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5H21a.75.75 0 01.75.75zM17.834 18.894a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 10-1.061 1.06l1.59 1.591zM12 18a.75.75 0 01.75.75V21a.75.75 0 01-1.5 0v-2.25A.75.75 0 0112 18zM7.758 17.303a.75.75 0 00-1.061-1.06l-1.591 1.59a.75.75 0 001.06 1.061l1.591-1.59zM6 12a.75.75 0 01-.75.75H3a.75.75 0 010-1.5h2.25A.75.75 0 016 12zM6.697 7.757a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 00-1.061 1.06l1.59 1.591z" />
						</svg>
						<svg class="theme-icon-moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
							fill="currentColor">
							<path fill-rule="evenodd"
								d="M9.528 1.718a.75.75 0 01.162.819A8.97 8.97 0 009 6a9 9 0 009 9 8.97 8.97 0 003.463-.69.75.75 0 01.981.98 10.503 10.503 0 01-9.694 6.46c-5.799 0-10.5-4.701-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 01.818.162z"
								clip-rule="evenodd" />
						</svg>
					</span>
				</button>
			</div>
		</div>
	</div>
</nav>

<main>
<div class="mx-auto max-w-7xl px-4 py-1 sm:px-6 lg:px-8">
	<div id="notification-area" class="mb-6 space-y-3"></div>
	<div class="card-base">
		<form id="tts-form" action="#" method="post" class="flex flex-col" onsubmit="return false;">
			<div class="p-6 sm:p-8">
				<div class="mb-5">
					<label for="text" class="label-base">Text to synthesize</label>
					<p class="text-xs text-slate-500 dark:text-slate-400 mb-2">
						Enter the text you want to convert to speech. For audiobooks, you can paste long
						chapters.

<div class="relative mb-6">
	<textarea name="text" id="text" rows="8" class="textarea-base"
		placeholder="Enter text here..." required></textarea>
	<div class="absolute bottom-2.5 right-3 text-xs text-slate-500 dark:text-slate-400">
		<span id="char-count">0</span> Characters
	</div>
</div>

<div class="flex flex-wrap items-center gap-x-6 gap-y-3 mb-6 justify-start">
    <button type="button" id="generate-btn" class="btn-primary">
        <svg xmlns="http://www.w3.org/2000/svg" 
             fill="none" viewBox="0 0 24 24" 
             stroke-width="1.5" stroke="currentColor" 
             class="w-5 h-5 mr-1.5 inline-block">
            <path stroke-linecap="round" stroke-linejoin="round" 
                  d="M12 3v2m0 14v2m9-9h-2M5 12H3m15.364-6.364l-1.414 1.414M6.05 17.95l-1.414 1.414M17.95 17.95l1.414 1.414M6.05 6.05L4.636 4.636" />
        </svg>
        Generate Speech
    </button>
    <button type="button" id="copy-btn" class="btn-secondary px-4 py-2 rounded-md">üìã Copy</button>
    <button type="button" id="paste-btn" class="btn-secondary px-4 py-2 rounded-md">üì• Paste</button>
    <button type="button" id="clear-btn" class="btn-danger px-4 py-2 rounded-md">üóë Clear</button>
    <button type="button" id="accent-btn" class="btn-secondary px-4 py-2 rounded-md">üá∑üá∫ Stress</button>
</div>

<div id="popup-msg"
    class="fixed bottom-6 left-1/2 -translate-x-1/2 bg-slate-800 text-white text-sm px-4 py-2 rounded-lg shadow-lg opacity-0 pointer-events-none transition-all duration-500 z-50">
</div>


<script>
    const textarea = document.getElementById("text");
    const copyBtn = document.getElementById("copy-btn");
    const pasteBtn = document.getElementById("paste-btn");
    const clearBtn = document.getElementById("clear-btn");
    const popup = document.getElementById("popup-msg");

    function showPopup(message) {
        popup.innerText = message;
        popup.classList.remove("opacity-0", "pointer-events-none");
        setTimeout(() => {
            popup.classList.add("opacity-0", "pointer-events-none");
        }, 2000);
    }

    copyBtn.addEventListener("click", async () => {
        try {
            await navigator.clipboard.writeText(textarea.value);
            showPopup("‚úÖ Text copied!");
        } catch (err) {
            showPopup("‚ö† Clipboard blocked ‚Äî copy manually.");
        }
    });

    pasteBtn.addEventListener("click", async () => {
        try {
            const text = await navigator.clipboard.readText();
            textarea.value += (textarea.value ? "\n" : "") + text;
            showPopup("üì• Text pasted!");
        } catch (err) {
            const input = document.createElement("textarea");
            input.setAttribute("placeholder", "Paste text here...");
            input.className =
                "fixed bottom-10 left-1/2 -translate-x-1/2 w-[90%] h-[100px] border border-slate-400 rounded-xl p-2 bg-white shadow-xl z-[9999]";
            document.body.appendChild(input);

            input.focus({ preventScroll: true });
            showPopup("üì± Mobile paste box opened");

            input.addEventListener("blur", () => {
                textarea.value += (textarea.value ? "\n" : "") + input.value;
                document.body.removeChild(input);
                showPopup("üì• Text added manually!");
            });
        }
    });

    clearBtn.addEventListener("click", () => {
        textarea.value = "";
        document.getElementById("char-count").innerText = "0";
        showPopup("üóë Cleared!");
    });

    textarea.addEventListener("input", () => {
        document.getElementById("char-count").innerText = textarea.value.length;
    });

    const accentBtn = document.getElementById("accent-btn");
    accentBtn.addEventListener("click", async () => {
        try {
            const response = await fetch("/api/accentuate", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ text: textarea.value })
            });
            const data = await response.json();
            if (data.status === "success") {
                textarea.value = data.accented_text;
                document.getElementById("char-count").innerText = textarea.value.length;
                showPopup("üá∑üá∫ stresses are placed!");
            } else {
                showPopup("‚ö† Error while stresses setup");
            }
        } catch (err) {
            showPopup("‚ùå API unavailable: " + err);
        }
    });
</script>


<script>
async function initUI() {
    try {
        const response = await fetch("/api/ui/initial-data");
        const data = await response.json();

        if (Array.isArray(data.languages)) {
            const langSelect = document.getElementById("language");
            langSelect.innerHTML = "";
            data.languages.forEach(lang => {
                const opt = document.createElement("option");
                opt.value = lang;
                opt.textContent = `${lang} (${lang})`;
                langSelect.appendChild(opt);
            });

            // –≤—ã—Å—Ç–∞–≤–ª—è–µ–º –¥–µ—Ñ–æ–ª—Ç, –µ—Å–ª–∏ –µ—Å—Ç—å
            if (data.config?.generation?.default_language) {
                langSelect.value = data.config.generation.default_language;
            }
        }
    } catch (err) {
        console.error("Failed to initialize UI:", err);
    }
}

document.addEventListener("DOMContentLoaded", initUI);
</script>


<div class="flex flex-wrap items-center gap-x-6 gap-y-4 mb-6 relative">
    <button id="restart-btn" class="btn-primary flex items-center justify-center">
        üîÑ Restart Server üîÑ
    </button>
</div>

<script>
document.getElementById("restart-btn").addEventListener("click", async () => {
    try {
        const response = await fetch("/api/restart", { method: "POST" });
        const data = await response.json();
        alert(data.message); // Server restarting...
    } catch (err) {
        alert("Failed to call restart API: " + err);
    }
});
</script>

<style>
/* LED lights style */
.led-light {
    position: absolute;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: red;
    animation: spin-led 3s linear infinite;
    animation-delay: calc(var(--i) * 0.25s);
}

/* place lights at corners and edges */
.led-light:nth-child(1) { top: -4px; left: -4px; background: red; }
.led-light:nth-child(2) { top: -4px; left: 50%; transform: translateX(-50%); background: orange; }
.led-light:nth-child(3) { top: -4px; right: -4px; background: yellow; }
.led-light:nth-child(4) { top: 50%; right: -4px; transform: translateY(-50%); background: green; }
.led-light:nth-child(5) { bottom: -4px; right: -4px; background: blue; }
.led-light:nth-child(6) { bottom: -4px; left: 50%; transform: translateX(-50%); background: purple; }
.led-light:nth-child(7) { bottom: -4px; left: -4px; background: pink; }
.led-light:nth-child(8) { top: 50%; left: -4px; transform: translateY(-50%); background: cyan; }

@keyframes spin-led {
    0% { transform: rotate(0deg) translate(50px) rotate(0deg); }
    100% { transform: rotate(360deg) translate(50px) rotate(-360deg); }
}

/* optional hover effect */
#restart-btn:hover {
    transform: scale(1.05);
    transition: transform 0.2s;
}
</style>  


<div class="mb-6">
<label for="split-text-toggle"
	class="flex items-center cursor-pointer text-sm label-base select-none">
	<input type="checkbox" id="split-text-toggle" name="split_text"
		class="mr-2 h-4 w-4 rounded border-slate-300 text-indigo-600 focus:ring-indigo-500 dark:border-slate-600 dark:bg-slate-700 dark:focus:ring-offset-slate-800 dark:checked:bg-indigo-500 dark:checked:border-indigo-500">
	Split text into chunks
</label>

<details class="group" open>
	<summary class="list-none flex cursor-pointer items-center group mt-2">
		<span class="text-xs font-medium label-base group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors">
			Chunking Details
		</span>
		<span class="ml-1.5 text-slate-400 group-hover:text-indigo-500 dark:group-hover:text-indigo-400 transition-colors">
			<svg class="group-open:rotate-180 h-4 w-4 transition-transform duration-200 ease-in-out"
				viewBox="0 0 20 20" fill="currentColor">
				<path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
			</svg>
		</span>
	</summary>

	<div id="chunk-size-controls" class="flex items-center space-x-2 mt-2">
		<label for="chunk-size-slider" class="text-sm label-base whitespace-nowrap">Chunk
			Size:</label>
		<input type="range" id="chunk-size-slider" name="chunk_size" min="50" max="1000"
			step="10" value="120" class="slider-base w-32">
		<span id="chunk-size-value"
			class="text-sm font-medium text-slate-700 dark:text-slate-300 w-10 text-right tabular-nums">120</span>
	</div>
	<p id="chunk-explanation" class="text-xs text-slate-500 dark:text-slate-400 mt-2">
		Splitting is essential for longer texts like articles or audiobook chapters.
		Recommended chunk size: ~150-400 characters.
	</p>
</details>
</div>
<div class="mb-6">
<details class="group" open>
	<summary class="list-none flex cursor-pointer items-center group">
		<label class="label-base mb-2 m-0 cursor-pointer">Voice Mode:</label>
		<span class="ml-1.5 text-slate-400 group-hover:text-indigo-500 dark:group-hover:text-indigo-400 transition-colors">
			<svg class="group-open:rotate-180 h-4 w-4 transition-transform duration-200 ease-in-out"
				viewBox="0 0 20 20" fill="currentColor">
				<path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
			</svg>
		</span>
	</summary>
	
	<div class="mt-2">
		<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
			<label class="voice-mode-option" data-mode="predefined">
				<input type="radio" name="voice_mode" value="predefined" class="hidden peer">
				<span>Predefined Voices</span>
			</label>
			<label class="voice-mode-option" data-mode="clone">
				<input type="radio" name="voice_mode" value="clone" class="hidden peer"
					checked>
				<span>Voice Cloning (Reference)</span>
			</label>
		</div>

		<div id="predefined-voice-options" class="mb-6 mt-4">
			<details class="group" open>
				<summary class="list-none flex cursor-pointer items-center group">
					<span class="text-sm font-medium label-base group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors">
						Select Predefined Voice:
					</span>
					<span class="ml-1.5 text-slate-400 group-hover:text-indigo-500 dark:group-hover:text-indigo-400 transition-colors">
						<svg class="group-open:rotate-180 h-5 w-5 transition-transform duration-200 ease-in-out"
							viewBox="0 0 20 20" fill="currentColor">
							<path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
						</svg>
					</span>
				</summary>
				
				<div class="mt-2 flex items-center gap-2">
					<select id="predefined-voice-select" name="predefined_voice_select"
						class="select-base flex-grow">
						<option value="none">-- Select Voice --</option>
					</select>
					<input type="file" id="predefined-voice-file-input" class="hidden" multiple
						accept=".wav,.mp3" aria-label="Upload predefined voice file">
					<button type="button" id="predefined-voice-import-button" class="btn-import"
						title="Import new predefined voice files">
						<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
							<path d="M9.25 13.25a.75.75 0 0 0 1.5 0V4.636l2.955 3.129a.75.75 0 0 0 1.09-1.03l-4.25-4.5a.75.75 0 0 0-1.09 0l-4.25 4.5a.75.75 0 1 0 1.09 1.03L9.25 4.636v8.614Z" />
							<path d="M3.5 12.75a.75.75 0 0 0-1.5 0v2.5A2.75 2.75 0 0 0 4.75 18h10.5A2.75 2.75 0 0 0 18 15.25v-2.5a.75.75 0 0 0-1.5 0v2.5c0 .69-.56 1.25-1.25 1.25H4.75c-.69 0-1.25-.56-1.25-1.25v-2.5Z" />
						</svg>
						Import
					</button>
					<button type="button" id="predefined-voice-refresh-button" class="btn-refresh"
						title="Refresh predefined voice list">
						<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
							<path fill-rule="evenodd" d="M15.312 11.424a5.5 5.5 0 0 1-9.201-4.42 5.5 5.5 0 0 1 10.89 2.01a.75.75 0 0 1-1.49.174a4 4 0 0 0-7.486-2.641a4 4 0 0 0 6.688 2.947a.75.75 0 0 1 .999.057l-.004-.005ZM4.688 8.576a5.5 5.5 0 0 1 9.201 4.42a5.5 5.5 0 0 1-10.89-2.01a.75.75 0 0 1 1.49-.174a4 4 0 0 0 7.486 2.641a4 4 0 0 0-6.688-2.947a.75.75 0 0 1-.999-.057l.004.005Z"
								clip-rule="evenodd" />
						</svg>
						Refresh
					</button>
				</div>
			</details>
		</div>

		<div id="clone-options" class="mb-6">
			<details class="group" open>
				<summary class="list-none flex cursor-pointer items-center group">
					<span class="text-sm font-medium label-base group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors">
						Reference Audio File:
					</span>
					<span class="ml-1.5 text-slate-400 group-hover:text-indigo-500 dark:group-hover:text-indigo-400 transition-colors">
						<svg class="group-open:rotate-180 h-5 w-5 transition-transform duration-200 ease-in-out"
							viewBox="0 0 20 20" fill="currentColor">
							<path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
						</svg>
					</span>
				</summary>

				<div class="mt-2">
					<p class="text-xs text-slate-500 dark:text-slate-400 mb-2">
						Select an uploaded <code class="code-inline">.wav</code> or <code
							class="code-inline">.mp3</code> file.
						For best results, use clean audio recordings.
					</p>
					<div class="flex items-center gap-2">
						<select id="clone-reference-select" name="clone_reference_select"
							class="select-base flex-grow">
							<option value="none">-- Select Reference File --</option>
						</select>
						<input type="file" id="clone-file-input" class="hidden" multiple accept=".wav,.mp3"
							aria-label="Upload reference audio file">
						<button type="button" id="clone-import-button" class="btn-import"
							title="Import new reference files">
							<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
								<path d="M9.25 13.25a.75.75 0 0 0 1.5 0V4.636l2.955 3.129a.75.75 0 0 0 1.09-1.03l-4.25-4.5a.75.75 0 0 0-1.09 0l-4.25 4.5a.75.75 0 1 0 1.09 1.03L9.25 4.636v8.614Z" />
								<path d="M3.5 12.75a.75.75 0 0 0-1.5 0v2.5A2.75 2.75 0 0 0 4.75 18h10.5A2.75 2.75 0 0 0 18 15.25v-2.5a.75.75 0 0 0-1.5 0v2.5c0 .69-.56 1.25-1.25 1.25H4.75c-.69 0-1.25-.56-1.25-1.25v-2.5Z" />
							</svg>
							Import
						</button>
						<button type="button" id="clone-refresh-button" class="btn-refresh"
							title="Refresh reference file list">
							<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
								<path fill-rule="evenodd" d="M15.312 11.424a5.5 5.5 0 0 1-9.201-4.42 5.5 5.5 0 0 1 10.89 2.01a.75.75 0 0 1-1.49.174a4 4 0 0 0-7.486-2.641a4 4 0 0 0 6.688 2.947a.75.75 0 0 1 .999.057l-.004-.005ZM4.688 8.576a5.5 5.5 0 0 1 9.201 4.42a5.5 5.5 0 0 1-10.89-2.01a.75.75 0 0 1 1.49-.174a4 4 0 0 0 7.486 2.641a4 4 0 0 0-6.688-2.947a.75.75 0 0 1-.999-.057l.004.005Z"
									clip-rule="evenodd" />
							</svg>
							Refresh
						</button>
					</div>
				</div>
			</details>
		</div>
		</div>
</details>
</div>
 
<div class="mb-6">
<details class="group" open>
<summary class="list-none flex cursor-pointer items-center group">
	<span class="text-sm font-medium label-base group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors">
		Load Example Preset:
	</span>
	<span class="ml-1.5 text-slate-400 group-hover:text-indigo-500 dark:group-hover:text-indigo-400 transition-colors">
		<svg class="group-open:rotate-180 h-5 w-5 transition-transform duration-200 ease-in-out"
			viewBox="0 0 20 20" fill="currentColor">
			<path fill-rule="evenodd"
				d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
				clip-rule="evenodd" />
		</svg>
	</span>
</summary>

<div id="presets-container" class="mt-2 flex flex-wrap gap-2">
	<p id="presets-placeholder" class="text-sm text-slate-500 dark:text-slate-400">
		Loading presets...</p>
</div>
</details>
</div>

<div class="mb-6">
<details class="group" open>
<summary class="list-none flex cursor-pointer items-center group">
	<span
		class="text-sm font-medium label-base group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors">Generation
		Parameters</span>
	<span
		class="ml-1.5 text-slate-400 group-hover:text-indigo-500 dark:group-hover:text-indigo-400 transition-colors">
		<svg class="group-open:rotate-180 h-5 w-5 transition-transform duration-200 ease-in-out"
			viewBox="0 0 20 20" fill="currentColor">
			<path fill-rule="evenodd"
				d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
				clip-rule="evenodd" />
		</svg>
	</span>
</summary>
<div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-5">
	<div>
	<label for="temperature" class="label-base">Temperature (<span
			id="temperature-value"
			class="font-semibold tabular-nums">0.8</span>)</label>
	<input type="range" id="temperature" name="temperature" min="0.0" max="1.5"
		step="0.01" value="0.8" class="slider-base">
	</div>
	<div>
		<label for="exaggeration" class="label-base">Exaggeration (<span
				id="exaggeration-value"
				class="font-semibold tabular-nums">0.5</span>)</label>
		<input type="range" id="exaggeration" name="exaggeration" min="0.0"
			max="2.0" step="0.01" value="0.5" class="slider-base">
	</div>
	<div>
		<label for="cfg-weight" class="label-base">CFG Weight (<span
				id="cfg-weight-value"
				class="font-semibold tabular-nums">0.5</span>)</label>
		<input type="range" id="cfg-weight" name="cfg_weight" min="0.0" max="2.0"
			step="0.01" value="0.5" class="slider-base">
	</div>
	<div>
		<label for="speed-factor" class="label-base">
			Speed Factor (<span id="speed-factor-value"
				class="font-semibold tabular-nums">1.0</span>)
			<span id="speed-factor-warning"
				class="text-xs text-yellow-600 dark:text-yellow-400 ml-2 hidden"></span>
		</label>
		<input type="range" id="speed-factor" name="speed_factor" min="0.25"
			max="4.0" step="0.05" value="1.0" class="slider-base">
	</div>
	<div>
		<label for="seed" class="label-base">Generation Seed</label>
		<div class="w-36">
			<input type="number" id="seed" name="seed" value="0"
				placeholder="0 (or -1 for random)" class="input-base"
				title="Enter an integer seed for reproducible results, or -1 for random. 0 may also be random depending on engine.">
		</div>
		<p class="text-xs text-slate-500 dark:text-slate-400 mt-1.5">
			Integer for reproducible results. Some engines use 0 or -1 for random.
		</p>
	</div>

	<div id="language-select-container">
		<label for="language" class="label-base">Language</label>
		<div class="flex items-center gap-2">
			<select id="language" name="language" class="select-base flex-grow">
				<option value="en">English (en)</option>
			</select>
		</div>
	</div>
	<div>

	<label for="output-format" class="label-base">Output Format</label>
	<select id="output-format" name="output_format" class="select-base w-36">
		<option value="wav">WAV</option>
		<option value="mp3" selected>MP3</option>
		<option value="opus">Opus</option>
	</select>
	<p class="text-xs text-slate-500 dark:text-slate-400 mt-1.5">
		MP3 is recommended for smaller file sizes (e.g., audiobooks).
	</p>
	</div>
	<div class="col-span-1 md:col-span-2 mt-4 flex items-center gap-4">
		<button id="save-gen-defaults-btn" type="button" class="btn-settings">Save
			Generation Parameters</button>
		<span id="gen-defaults-status" class="text-xs hidden"></span>
	</div>
	</div>
	</details>
</div>

<div class="mb-6">
	<details class="group" open> <!-- Server Config expanded by default -->
		<summary class="list-none flex cursor-pointer items-center group">
			<span
				class="text-sm font-medium label-base group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors">Server
				Configuration</span>
			<span
				class="ml-1.5 text-slate-400 group-hover:text-indigo-500 dark:group-hover:text-indigo-400 transition-colors">
				<svg class="group-open:rotate-180 h-5 w-5 transition-transform duration-200 ease-in-out"
					viewBox="0 0 20 20" fill="currentColor">
					<path fill-rule="evenodd"
						d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
						clip-rule="evenodd" />
				</svg>
			</span>
			</summary>
			<div id="server-config-form"
				class="mt-4 border-t border-slate-200 dark:border-slate-700 pt-5">
				<p class="text-xs text-slate-500 dark:text-slate-400 mb-4">
					These settings are loaded from <code class="code-inline">config.yaml</code>
					via an API call.
					<strong class="font-medium">Restart the server</strong> to apply changes to
					Host, Port, Model, or Path settings if modified here or directly in the
					file.
				</p>
				<div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
					<div><label for="config-server-host" class="label-base text-xs">Server
							Host</label><input type="text" id="config-server-host"
							name="server.host" class="input-base text-sm"></div>
					<div><label for="config-server-port" class="label-base text-xs">Server
							Port</label><input type="number" id="config-server-port"
							name="server.port" class="input-base text-sm"></div>
					<div><label for="config-tts-engine-device" class="label-base text-xs">TTS
							Device</label><input type="text" id="config-tts-engine-device"
							name="tts_engine.device" class="input-base text-sm"></div>
					<div><label for="config-tts-engine-default_voice_id"
							class="label-base text-xs">Default Voice ID</label><input
							type="text" id="config-tts-engine-default_voice_id"
							name="tts_engine.default_voice_id" class="input-base text-sm"></div>
					<div><label for="config-paths-model_cache" class="label-base text-xs">Model
							Cache Path</label><input type="text" id="config-paths-model_cache"
							name="paths.model_cache" class="input-base text-sm"></div>
					<div><label for="config-tts-engine-predefined_voices_path"
							class="label-base text-xs">Predefined Voices Path</label><input
							type="text" id="config-tts-engine-predefined_voices_path"
							name="tts_engine.predefined_voices_path" class="input-base text-sm">
					</div>
					<div><label for="config-tts-engine-reference_audio_path"
							class="label-base text-xs">Reference Audio Path</label><input
							type="text" id="config-tts-engine-reference_audio_path"
							name="tts_engine.reference_audio_path" class="input-base text-sm">
					</div>
					<div><label for="config-paths-output" class="label-base text-xs">Output
							Path</label><input type="text" id="config-paths-output"
							name="paths.output" class="input-base text-sm"></div>
					<div><label for="config-audio_output-format"
							class="label-base text-xs">Audio Output Format</label><input
							type="text" id="config-audio_output-format"
							name="audio_output.format" class="input-base text-sm"></div>
					<div><label for="config-audio_output-sample_rate"
							class="label-base text-xs">Audio Sample Rate</label><input
							type="number" id="config-audio_output-sample_rate"
							name="audio_output.sample_rate" class="input-base text-sm"></div>

					<div
						class="col-span-1 md:col-span-2 mt-4 flex flex-col md:flex-row gap-4 items-center">
						<button id="save-config-btn" type="button" class="btn-settings">Save
							Server Configuration</button>
						<button id="restart-server-btn" type="button"
							class="btn-danger w-full md:w-auto hidden">
							<svg xmlns="http://www.w3.org/2000/svg" fill="none"
								viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
								class="w-5 h-5 mr-1.5 inline-block">
								<path stroke-linecap="round" stroke-linejoin="round"
									d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99" />
							</svg>
							Restart Server
						</button>
						<span id="config-status" class="text-xs ml-2 hidden"></span>
					</div>
				</div>
			</div>
		</details>
	</div>
</div>

</form>
</div>
<div class="card-base mt-4">
	<details class="group" open>
		<summary class="list-none flex cursor-pointer items-center group p-6 sm:p-8">
			<span class="text-sm font-medium label-base group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors">
				App Settings
			</span>
			<span class="ml-1.5 text-slate-400 group-hover:text-indigo-500 dark:group-hover:text-indigo-400 transition-colors">
				<svg class="group-open:rotate-180 h-5 w-5 transition-transform duration-200 ease-in-out"
					viewBox="0 0 20 20" fill="currentColor">
					<path fill-rule="evenodd"
						d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
						clip-rule="evenodd" />
				</svg>
			</span>
		</summary>
		
		<div class="p-6 sm:p-8 border-t border-slate-200 dark:border-slate-700">
			<div class="flex items-center">
				<button id="reset-settings-btn" type="button" class="btn-settings">Reset All Settings</button>
				<div class="text-xs text-slate-500 dark:text-slate-400 ml-2">
					Resets settings to their defaults.
				</div>
			</div>
		</div>
	</details>
</div>

<div id="audio-player-container" class="mt-8"></div>

<div class="card-base mt-6">
	<div class="p-6 sm:p-8">
		<h3 class="card-header mb-4">Audio File Name</h3>
		<div class="mb-4">
			<label for="audio-name" class="label-base">Custom Audio Name</label>
			<div class="flex items-center gap-2">
				<input type="text" id="audio-name" name="audio_name" class="input-base flex-grow" 
					   placeholder="Enter custom name for audio file (without extension)">
				<button type="button" id="set-audio-name-btn" class="btn-primary">
					Set Audio Name
				</button>
			</div>
			<p class="text-xs text-slate-500 dark:text-slate-400 mt-1.5">
				Set a custom name for the generated audio file. If empty, default name will be used.
				<strong>Current name:</strong> <span id="current-audio-name" class="font-semibold">Default</span>
			</p>
		</div>
	</div>
</div>

<div id="audio-player-container" class="mt-8"></div>

<div class="mt-10">
	<h2 class="card-header mb-4 text-base font-semibold">Tips & Tricks</h2>
	<div class="card-base">
		<div class="p-6 sm:p-8">
			<ul class="list-disc space-y-2.5 pl-5 text-sm text-slate-700 dark:text-slate-300">
				<li>For **Audiobooks**, use **MP3** format, enable **Split text**, and set a chunk size
					of ~250-500.</li>
				<li>Use **Predefined Voices** for consistent, high-quality output. You can import new
					ones.</li>
				<li>For **Voice Cloning**, upload clean reference audio (<code
						class="code-inline">.wav</code>/<code class="code-inline">.mp3</code>). Quality
					of reference is key.</li>
				<li>Experiment with **Temperature** and other generation parameters to fine-tune output.
				</li>
			</ul>
		</div>
	</div>
</div>
	</div>
</main>

<footer class="bg-slate-100 dark:bg-slate-800 py-8 mt-16 border-t border-slate-200 dark:border-slate-700/80">
	<div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
		<div class="flex justify-center">
			<a href="https://github.com/devnen/Chatterbox-TTS-Server" target="_blank" rel="noopener noreferrer"
				class="flex items-center gap-2 text-slate-500 dark:text-slate-400 text-sm hover:text-indigo-600 dark:hover:text-indigo-400 transition-colors">
				<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor"
					viewBox="0 0 16 16" class="flex-shrink-0">
					<path
						d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z" />
				</svg>
				<span>View Project on GitHub | Powered by FastAPI</span>
			</a>
		</div>
	</div>
</footer>
</div>

<div id="loading-overlay" class="loading-overlay-base hidden opacity-0" data-state="closed" style="display: none;">
	<div class="loading-box-base">
		
		<div class="relative flex items-center justify-center mb-4" style="width: 50px; height: 50px;">
			<div class="colorful-spinner-small absolute w-full h-full rounded-full"></div>
			
			<p id="counter" class="text-xl font-bold text-indigo-500 dark:text-indigo-400 tabular-nums relative z-10">0</p>
		</div>
		<p id="loading-message" class="loading-text">Generating audio...</p>
		<p id="loading-status" class="loading-status">Please wait.</p>
		<button id="loading-cancel-btn" type="button" class="btn-secondary mt-1"
			title="Cancel UI request. Backend may continue briefly.">Cancel</button>
	</div>
</div>
    
<style>
/* Ensure this CSS block is present in your HTML file for styling and animation */
.colorful-spinner-small {
	width: 50px;
	height: 50px;
	
	/* Smaller, colorful gradient border */
	background: conic-gradient(
		#ff0000, 
		#ff8c00, 
		#ffd700, 
		#32cd32, 
		#00bfff, 
		#9932cc, 
		#ff0000  
	);
	
	/* Animation for spinning */
	animation: spin 1.5s linear infinite; 
	
	/* Creates the small ring effect */
	-webkit-mask: radial-gradient(circle at center, transparent 15px, black 18px);
	mask: radial-gradient(circle at center, transparent 15px, black 18px);
}

/* Define the spinning animation */
@keyframes spin {
	0% { transform: rotate(0deg); }
	100% { transform: rotate(360deg); }
}
</style>

<script>
	// Global variables for counter logic
	let counterInterval = null;
	let counterValue = 0;

	// Function to start the counter: 1, 2, 3...
	function startCounter() {
		const counterElement = document.getElementById('counter');
		if (!counterElement) return;

		counterValue = 0;
		counterElement.textContent = counterValue;
		
		// Starts counting every 1 second (1000ms)
		counterInterval = setInterval(() => {
			counterValue++;
			counterElement.textContent = counterValue;
		}, 1000); 
	}

	// Function to stop and reset the counter
	function stopCounter() {
		if (counterInterval !== null) {
			clearInterval(counterInterval);
			counterInterval = null;
		}
		const counterElement = document.getElementById('counter');
		if(counterElement) {
			 counterElement.textContent = '0';
		}
	}
	
	// --- Integration Logic ---
	// This watches the loading popup to start/stop the counter automatically.
	const loadingOverlay = document.getElementById('loading-overlay');
	const loadingCancelBtn = document.getElementById('loading-cancel-btn');

	if (loadingOverlay) {
		const observer = new MutationObserver((mutations) => {
			mutations.forEach((mutation) => {
				if (mutation.type === 'attributes' && mutation.attributeName === 'data-state') {
					const newState = loadingOverlay.getAttribute('data-state');
					if (newState === 'open') {
						startCounter(); // Start counting when the popup shows
					} else if (newState === 'closed') {
						stopCounter();  // Stop counting when the popup hides
					}
				}
			});
		});

		// Start observing the loading overlay for changes
		observer.observe(loadingOverlay, { attributes: true });
	}

	// Stops the counter if the user clicks Cancel
	if (loadingCancelBtn) {
		loadingCancelBtn.addEventListener('click', stopCounter);
	}

</script>

<div id="chunk-warning-modal" class="modal-overlay hidden opacity-0" data-state="closed" style="display: none;">
        <div class="modal-box">
            <h3 class="modal-title">Chunking Voice Consistency Warning</h3>
            <div class="modal-content">
                <p>You are generating with text splitting enabled and not using Predefined Voices or Voice Cloning with
                    a fixed seed.</p>
                <p class="mt-2">This combination may result in <strong class="font-semibold">different voices for
                        different text chunks</strong>, leading to inconsistent audio.</p>
                <p class="mt-2">For consistent voices across chunks, please use:</p>
                <ul class="list-disc pl-5 mt-1 space-y-1">
                    <li>"Predefined Voices" mode.</li>
                    <li>"Voice Cloning" mode.</li>
                    <li>A specific integer in "Generation Seed" (not random).</li>
                </ul>
            </div>
            <div class="mt-4 mb-5 flex items-center">
                <input type="checkbox" id="hide-chunk-warning-checkbox"
                    class="h-4 w-4 rounded border-slate-300 text-indigo-600 focus:ring-indigo-500 dark:border-slate-600 dark:bg-slate-700 dark:focus:ring-offset-slate-800 dark:checked:bg-indigo-500 dark:checked:border-indigo-500">
                <label for="hide-chunk-warning-checkbox"
                    class="ml-2 block text-sm text-slate-700 dark:text-slate-300 cursor-pointer">Do not show this
                    warning again</label>
            </div>
            <div class="modal-actions">
                <button id="chunk-warning-cancel" type="button" class="btn-secondary">Cancel Generation</button>
                <button id="chunk-warning-ok" type="button" class="btn-primary">Proceed Anyway</button>
            </div>
        </div>
    </div>

<div id="generation-warning-modal" class="modal-overlay hidden opacity-0" data-state="closed"
	style="display: none;">
        <div class="modal-box">
            <h3 class="modal-title">Generation Quality Notice</h3>
            <div class="modal-content">
                <p>Please be aware that text-to-speech models may sometimes produce unexpected results or artifacts.</p>
                <p class="mt-2">This can include variations in voice consistency, delivery, or minor audio
                    imperfections. Experiment with parameters for best results.</p>
</div>


            <div class="mt-4 mb-5 flex items-center">
                <input type="checkbox" id="hide-generation-warning-checkbox"
                    class="h-4 w-4 rounded border-slate-300 text-indigo-600 focus:ring-indigo-500 dark:border-slate-600 dark:bg-slate-700 dark:focus:ring-offset-slate-800 dark:checked:bg-indigo-500 dark:checked:border-indigo-500">
                <label for="hide-generation-warning-checkbox"
                    class="ml-2 block text-sm text-slate-700 dark:text-slate-300 cursor-pointer">Do not show this
                    warning again</label>

            </div>
            <div class="modal-actions">
                <button id="generation-warning-acknowledge" type="button" class="btn-primary">Acknowledge &
                    Generate</button>
            </div>
        </div>
    </div>

   
    <script src="script.js" defer></script>

<script>
const LANGUAGE_LABELS = {
    en: "English", ru: "Russian", de: "German", fr: "French", es: "Spanish",
    pt: "Portuguese", tr: "Turkish", zh: "Chinese", ja: "Japanese", ko: "Korean",
    hi: "Hindi", ar: "Arabic", sv: "Swedish", nl: "Dutch", pl: "Polish",
    it: "Italian", fi: "Finnish", no: "Norwegian", ms: "Malay", he: "Hebrew",
    el: "Greek", da: "Danish", sw: "Swahili"
};

document.addEventListener("DOMContentLoaded", async () => {
    try {
        const response = await fetch("/api/ui/initial-data");
        const data = await response.json();

        if (Array.isArray(data.languages)) {
            const langSelect = document.getElementById("language");
            langSelect.innerHTML = "";

            data.languages.forEach(code => {
                const label = LANGUAGE_LABELS[code] || code;
                const opt = document.createElement("option");
                opt.value = code;
                opt.textContent = `${label} (${code})`;
                langSelect.appendChild(opt);
            });

            // üîÑ Restore language from localStorage
            const savedLang = localStorage.getItem("lastLanguage");
            if (savedLang && data.languages.includes(savedLang)) {
                langSelect.value = savedLang;
            } else if (data.config?.generation?.default_language) {
                langSelect.value = data.config.generation.default_language;
            }

            // üîÑ saving language when changing
            langSelect.addEventListener("change", () => {
                localStorage.setItem("lastLanguage", langSelect.value);
            });
        }
    } catch (err) {
        console.error("‚ùå Failed to load languages:", err);
    }

    // üîÑ Copy/Paste/Clear buttons
    document.getElementById("copy-btn").addEventListener("click", () => {
        const text = document.getElementById("input-text").value;
        navigator.clipboard.writeText(text);
    });

    document.getElementById("paste-btn").addEventListener("click", async () => {
        const text = await navigator.clipboard.readText();
        document.getElementById("input-text").value = text;
    });

    document.getElementById("clear-btn").addEventListener("click", () => {
        document.getElementById("input-text").value = "";
    });
});
</script>
</body>
</html>
